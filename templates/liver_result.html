<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MediScan AI – Liver Disease Result</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg: linear-gradient(135deg,#0a0e1a,#02040a,#000);
  --card: linear-gradient(145deg,rgba(2,8,18,.92),rgba(2,6,15,.92));
  --border: rgba(148,163,184,.2);
  --green:#22c55e;
  --blue:#38bdf8;
  --yellow:#facc15;
  --red:#ef4444;
  --muted:#9ca3af;
  --text:#f5f5f5;
  --shadow:0 20px 40px rgba(0,0,0,.6);
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,"Segoe UI",sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  padding:1.4rem 2rem;
  border-bottom:1px solid var(--border);
  background:rgba(2,4,10,.9);
  backdrop-filter:blur(12px);
}

header h2{margin:0;font-size:1.6rem;font-weight:700}

main{
  max-width:1600px;
  margin:auto;
  padding:2rem;
  display:flex;
  flex-direction:column;
  gap:2rem;
}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:20px;
  padding:1.8rem;
  box-shadow:var(--shadow);
}

.card::before{
  content:'';
  display:block;
  height:4px;
  background:linear-gradient(90deg,var(--green),var(--blue));
  margin:-1.8rem -1.8rem 1.3rem;
}

.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:1.6rem}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:1.6rem}
.grid-1{display:grid;grid-template-columns:1fr}
.grid-auto{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1.6rem}

small{color:var(--muted)}
canvas{height:260px!important}
img{width:100%;border-radius:14px}

button{
  background:linear-gradient(135deg,var(--green),#16a34a);
  color:#02040a;
  border:none;
  padding:.8rem 1.5rem;
  border-radius:999px;
  font-weight:700;
  cursor:pointer;
}

.progress{
  height:8px;
  background:#1f2933;
  border-radius:8px;
  overflow:hidden;
  margin-bottom:.6rem;
}
.progress > div{height:100%}

footer{
  text-align:center;
  padding:1.5rem;
  font-size:.8rem;
  color:var(--muted);
  background:rgba(2,4,10,.85);
}

/* ===== Doctor Remarks Textarea ===== */
.doctor-textarea{
  width:100%;
  background:linear-gradient(145deg,#020812,#02040a);
  border:1px solid var(--border);
  border-radius:14px;
  color:var(--text);
  padding:1rem 1.2rem;
  font-family:inherit;
  font-size:.95rem;
  line-height:1.6;
  resize:none;
  box-shadow:inset 0 2px 6px rgba(0,0,0,.6);
  transition:border .25s ease, box-shadow .25s ease;
}

.doctor-textarea::placeholder{
  color:var(--muted);
}

.doctor-textarea:focus{
  outline:none;
  border-color:var(--green);
  box-shadow:
    0 0 0 1px var(--green),
    inset 0 2px 6px rgba(0,0,0,.6);
}


@media(max-width:1000px){
  .grid-3,.grid-2{grid-template-columns:1fr}
}
</style>
</head>

<body>

<header>
<h2><i class="fas fa-liver"></i> MediScan<span style="color:var(--green)">AI</span> – Liver Disease Diagnostic Report</h2>
</header>

<main>

<!-- ================= PATIENT INFO ================= -->
<div class="card">
<h3><i class="fas fa-user"></i> Patient & Scan Information</h3>
<div class="grid-auto">
  <div><small>Name</small><br><b>{{ patient_name }}</b></div>
  <div><small>Age</small><br><b>{{ age }}</b></div>
  <div><small>Gender</small><br><b>{{ gender }}</b></div>
  <div><small>Scan Type</small><br><b>Liver CT / MRI</b></div>
  <div><small>Scan Date</small><br><b>{{ scan_date }}</b></div>
  <div><small>Diagnosis</small><br><b>{{ predicted_label }}</b></div>
</div>
</div>

<!-- ================= CONFIDENCE & SEVERITY ================= -->
<div class="grid-2">
<div class="card">
<h3>Prediction Confidence</h3>
<p style="font-size:3.2rem;font-weight:800;color:var(--green)">{{ confidence }}%</p>
<small>
{% if confidence >= 80 %}
High confidence prediction
{% elif confidence >= 60 %}
Moderate confidence – clinical correlation advised
{% else %}
Low confidence – follow-up recommended
{% endif %}
</small>
</div>

<div class="card">
<h3>Severity Score</h3>
<p style="font-size:3rem;font-weight:800;color:var(--yellow)">{{ confidence }}/100</p>
<small>
{% if confidence >= 80 %}Severe liver involvement
{% elif confidence >= 60 %}Moderate liver involvement
{% else %}Mild liver involvement{% endif %}
</small>
</div>
</div>

<!-- ================= ANALYTICS ================= -->
<div class="grid-3">
<div class="card"><h4>Confidence Gauge</h4><canvas id="gauge"></canvas></div>
<div class="card"><h4>Disease Probability</h4><canvas id="donut"></canvas></div>
<div class="card"><h4>Threshold Comparison</h4><canvas id="threshold"></canvas></div>
</div>

<div class="grid-1">
<div class="card"><h4>Prediction Stability</h4><canvas id="stability"></canvas></div>
</div>

<div class="grid-1">
<div class="card"><h4>Class Confidence Distribution</h4><canvas id="classBar"></canvas></div>
</div>

<!-- ================= MODEL CONFIDENCE ================= -->
<div class="card">
<h4>Model Confidence Breakdown</h4>
<p>
Normal: {{ confidence }}% |
Liver Tumor: {{ 100 - confidence }}%
</p>
</div>

<!-- ================= XAI & REGIONS (UNCHANGED) ================= -->
<div class="grid-2">
<div class="card">
<h4>Explainable AI Summary</h4>
<p>
The model focused on high-contrast lesion regions highlighted in the heatmap,
strongly influencing the prediction of <b>{{ predicted_label }}</b>.
</p>
</div>

<div class="card">
<h4>Liver Segment Involvement</h4>
<small>Right Lobe</small>
<div class="progress"><div style="width:50%;background:#22c55e"></div></div>
<small>Left Lobe</small>
<div class="progress"><div style="width:30%;background:#38bdf8"></div></div>
<small>Caudate</small>
<div class="progress"><div style="width:20%;background:#facc15"></div></div>
</div>
</div>

<!-- ================= IMAGES ================= -->
<div class="grid-2">
<div class="card"><h4>Original Liver Scan</h4><img src="{{ original_url }}"></div>
<div class="card"><h4>AI Attention Heatmap</h4><img src="{{ heatmap_url }}"></div>
</div>

<!-- ================= NEW: TUMOR PROBABILITY INSIGHT ================= -->
<div class="card">
<h4>Tumor Probability Insight</h4>
<p>
The AI model estimates a
<b>{{ "high" if confidence >= 80 else "moderate" if confidence >= 60 else "low" }}</b>
probability of liver tumor presence based on imaging features learned during training.
</p>
</div>

<!-- ================= NEW: RISK SUMMARY ================= -->
<div class="card">
<h4>Risk Summary</h4>
<p style="font-size:1.2rem;font-weight:700">
{% if predicted_label == "Normal" %}
Low Risk – No abnormal liver tissue patterns detected
{% else %}
High Risk – Tumor-like patterns detected in liver scan
{% endif %}
</p>
</div>

<!-- ================= NEW: MODEL METADATA ================= -->
<div class="card">
<h4>Model Metadata</h4>
<ul style="color:var(--muted);line-height:1.6">
<li>Architecture: Convolutional Neural Network (CNN)</li>
<li>Input Image Size: 128 × 128</li>
<li>Classification Type: Binary (Normal vs Liver Tumor)</li>
<li>Training Data: Liver CT/MRI images</li>
<li>Framework: TensorFlow / Keras</li>
</ul>
</div>

<!-- ================= NEW: EXPLAINABILITY NOTE ================= -->
<div class="card">
<h4>Explainability Note</h4>
<p>
Heatmap highlights regions that most influenced the model decision,
providing visual justification for predictions and improving trust and transparency
in AI-assisted diagnosis.
</p>
</div>

<!-- ================= NEW: FOLLOW-UP TIMELINE ================= -->
<div class="card">
<h4>Suggested Follow-Up Timeline</h4>
<ul>
<li>Immediate Liver Function Tests (LFT)</li>
<li>Repeat imaging after 2–4 weeks if required</li>
<li>Specialist hepatology consultation for confirmation</li>
</ul>
</div>

<!-- ================= DOCTOR REVIEW ================= -->
<div class="grid-2">

  <div class="card">
    <h4><i class="fas fa-user-md"></i> Doctor Review Status</h4>
    <span class="badge" style="background:var(--yellow);color:#02040a">
      Pending Review
    </span>
    <p style="margin-top:.6rem;color:var(--muted);font-size:.85rem">
      Awaiting hepatologist validation
    </p>
  </div>

  <div class="card">
    <h4><i class="fas fa-notes-medical"></i> Doctor Remarks</h4>

    <textarea
      class="doctor-textarea"
      rows="5"
      placeholder="Enter hepatologist observations, diagnosis notes, or follow-up recommendations..."
    ></textarea>

    <small style="display:block;margin-top:.5rem">
      Notes will be reviewed before final diagnosis
    </small>
  </div>

</div>



<!-- ================= ACTIONS ================= -->
<div class="card" style="display:flex;justify-content:space-between;flex-wrap:wrap">
<p style="font-size:.85rem;color:var(--muted)">
<i class="fas fa-robot"></i> AI-assisted output. Not a final medical diagnosis.
</p>
<div>
<button onclick="location.href='/download_pdf'">Download PDF</button>
<button style="margin-left:.6rem;background:linear-gradient(135deg,var(--blue),#0284c7)"
onclick="location.href='/export_data'">Export Data</button>
</div>
</div>

</main>

<footer>
MediScan AI © 2025 • MCA Final Year Project
</footer>

<script>
const confidence = {{ confidence }};
const probs = {
  "Normal": confidence,
  "Liver Tumor": 100 - confidence
};

new Chart(gauge,{
  type:'doughnut',
  data:{datasets:[{data:[confidence,100-confidence],backgroundColor:['#22c55e','#1f2933']}]},
  options:{cutout:'80%',plugins:{legend:{display:false}}}
});

new Chart(donut,{
  type:'doughnut',
  data:{labels:Object.keys(probs),datasets:[{data:Object.values(probs),backgroundColor:['#22c55e','#ef4444']}]}
});

new Chart(threshold,{
  type:'bar',
  data:{labels:['Threshold','Prediction'],datasets:[{data:[60,confidence],backgroundColor:['#facc15','#22c55e']}]},
  options:{scales:{y:{beginAtZero:true,max:100}},plugins:{legend:{display:false}}}
});

new Chart(stability,{
  type:'line',
  data:{labels:['T1','T2','T3','T4'],
  datasets:[{data:[confidence-10,confidence-5,confidence,confidence+2],
  borderColor:'#38bdf8',fill:true,backgroundColor:'rgba(56,189,248,.15)',tension:.4}]},
  options:{scales:{y:{beginAtZero:true,max:100}}}
});

new Chart(classBar,{
  type:'bar',
  data:{labels:Object.keys(probs),
  datasets:[{data:Object.values(probs),backgroundColor:['#22c55e','#ef4444'],borderRadius:6}]},
  options:{scales:{y:{beginAtZero:true,max:100}},plugins:{legend:{display:false}}}
});
</script>

</body>
</html>
